# Kubernetes_RFD

```
Multiple Kubernetes projects for all kinds of problems.
```



## Prerequisites

You need to have a Kubernetes cluster available.

If you do not have one, you can virtualize with tools such as minikube in version v1.16.0 or higher. https://github.com/kubernetes/minikube

All the custom images that will be used in this repository have been generated by dockerfile or similar files from the following repository: https://github.com/JoseManuelPS/Docker_RFD

It is recommended to have a proprietary image repository such as Docker Registry or Nexus to facilitate the image management task.



## nexus_repository

This short tutorial explains in a simple way how to deploy the Nexus Repository OSS image repository (https://www.sonatype.com/nexus/repository-oss).

_Minikube considerations:_

_If you are using minikube add its ip to the /etc/hosts file with the following names:_
- _nexus.local_
- _docker.local_

_Use the following command to check it:_ 
```
minikube ip
```

_You must also enable the ingress addon. Use the following command to add it._
```
minikube addons enable ingress
```

**Important: A deployment is going to be carried out without certificates, if you want to carry out a deployment with certificates you can find more information at: https://help.sonatype.com/repomanager3**


### Recommended deploy instrucctions:
```
kubectl create --save-config -f <(path_to_nexus_namespaces)>
kubectl create --save-config -f <(path_to_nexus_deployment)> -f <(path_to_nexus_service)> -f <(path_to_nexus_ingress)>
```


### Example deploy instrucction:
```
kubectl create --save-config -f ~/projects/kubernetes_rfd/nexus_repository/ns.nexus_repository.yaml
kubectl create --save-config -f ~/projects/kubernetes_rfd/nexus_repository/deploy.nexus_repository.yaml -f ~/projects/kubernetes_rfd/nexus_repository/ingress.nexus_repository.yaml -f ~/projects/kubernetes_rfd/nexus_repository/service.nexus_repository.yaml
```


### Configure and access to your own Nexus repository.
Now your repository is ready. To use it, you must access to http://nexus.local address and complete the initial setup of your new Nexus repository. After the configuration is complete, you must create a new repository as type **docker(hosted)** with the port **5000**.

Once the deployment has been done, you can connect to it in the following way:

- Create or modify the file /etc/docker/daemon.json to include the following content:
```
{
    "insecure-registries" : [ "docker.local" ]
}
```
   _Minikube considerations:_

   _If you want to connect from outside minikube replace docker.local for docker.local:<(svc-nexus_nodeport)>_

- Reset Docker daemon. 

   _Minikube considerations: If you are using minikube remember that you must start it again after resetting the Docker daemon._

- Conmect to repository:
```
docker login docker.local
```
   _Minikube considerations:_

   _If you want to connect from outside minikube replace docker.local for docker.local:<(svc-nexus_nodeport)>_


### Push and pull images into your own Nexus repository.

To perform the push and pull actions use the following commands.
```
docker tag <(image_name:version)> docker.local:5000/<(repository_name)>/<(image_name:version)>
docker push docker.local:5000/<(repository_name)>/<(image_name:version)>

or

docker pull docker.local:5000/<(repository_name)>/<(image_name:version)>
```

   _Minikube considerations:_

   _If you want to connect from outside minikube replace docker.local for docker.local:<(svc-nexus_nodeport)>_

   

